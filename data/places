#!/bin/bash
###############################################
#                                             #
#       ToriOS OS Places Menu (JWM)           #
# copyright Israel <israel@torios.org> 2014   #
#               GPL3 License                  #
#                                             #
#      Prov 24:13 My son, eat thou honey,     #
#     because it is good; and the honeycomb,  #
#       which is sweet to thy taste:          #
# 14 So shall the knowledge of wisdom         #
# be unto thy soul: when thou hast found it,  #
#       then there shall be a reward,         #
#   and thy expectation shall not be cut off. #
#                                             #
#      Prose from KJV Bible public Domain     #
#                                             #
###############################################

## Lets make sure they have the file first
if [ ! -f "$HOME/.config/user-dirs.dirs" ]
then
  ## if not see if we can make it
  if [ ! -x /usr/bin/xdg-user-dirs-update ]
  then
    echo "/usr/bin/xdg-user-dirs-update doesn't exist!!
Please install xdg-user-dirs"
    exit 1
  else
    xdg-user-dirs-update && echo "created user dirs"
  fi
fi

if [ ! -x /usr/bin/xdg-user-dir ]
then
  echo "/usr/bin/xdg-user-dir doesn't exist!!
Please install xdg-user-dirs"
  exit 1
fi

PLACES="$HOME/.config/placesmenu"

XDG_COMM=xdg-user-dir
DESKTOP=$(xdg-user-dir DESKTOP)
DOCUMENTS=$(xdg-user-dir DOCUMENTS)
DOWNLOADS=$(xdg-user-dir DOWNLOAD)
MUSIC=$(xdg-user-dir MUSIC)
PICTURES=$(xdg-user-dir PICTURES)
PUBLICSHARE=$(xdg-user-dir PUBLICSHARE)
TEMPLATES=$(xdg-user-dir TEMPLATES)
VIDEOS=$(xdg-user-dir VIDEOS)
VIDEOS_DIR=${VIDEOS##$HOME/}
DESKTOP_DIR=${DESKTOP##$HOME/}
DOCUMENTS_DIR=${DOCUMENTS##$HOME/}
DOWNLOADS_DIR=${DOWNLOADS##$HOME/}
MUSIC_DIR=${MUSIC##$HOME/}
PICTURES_DIR=${PICTURES##$HOME/}
PUBLICSHARE_DIR=${PUBLICSHARE##$HOME/}
TEMPLATES_DIR=${TEMPLATES##$HOME/}
VIDEOS_DIR=${VIDEOS##$HOME/}
HOME_DIR="Home"

## This is for the Applications item
DD=/usr/share/desktop-directories
## Set a default value just incase we need it :)
APPS_NAME="Applications"
##make sure the directory exists before we assume it does
if [ -d "$DD" ]
then
  for APPS in ${DD}/jwm-appl* ; do
    while read NAME_LINE || [ "$NAME_LINE" ]; do
       case $NAME_LINE in
         Name?${myLANG%_*}?=*|Name=*) APPS_NAME="${NAME_LINE#*=}"'';;
       esac
     done < $APPS
  done
fi

MENU='<?xml version="1.0"?>
<JWM>
<!-- generated by '$0' -->
   <RootMenu height="0" onroot="7">
        <Program icon="application-default-icon.svg" label="'$APPS_NAME'">xdg-open /usr/share/applications</Program>
        <Program icon="folder-home.svg" label="'$HOME_DIR'">xdg-open '$HOME'</Program>
        <Program icon="folder-documents.svg" label="'$DOCUMENTS_DIR'">xdg-open '$DOCUMENTS'</Program>
        <Program icon="folder-downloads.svg" label="'$DOWNLOADS_DIR'">xdg-open '$DOWNLOADS'</Program>
        <Program icon="folder-music.svg" label="'$MUSIC_DIR'">xdg-open -n '$MUSIC'</Program>
        <Program icon="folder-pictures.svg" label="'$PICTURES_DIR'">xdg-open '$PICTURES'</Program>
        <Program icon="folder-video.svg" label="'$VIDEOS_DIR'">xdg-open '$VIDEOS'</Program>
        <Program icon="user-trash.svg" label="Trash">xdg-open ~/.local/share/Trash/files</Program>
        <Program icon="file-manager.svg" label="Connected Devices">xdg-open /media</Program>
    </RootMenu>
</JWM>'
echo "$MENU"
echo "$MENU" > $PLACES
RESULT=$(jwm -reload)
echo "Updated Places menu
$RESULT"
