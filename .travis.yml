language: cpp
sudo: required
dist: trusty
compiler: gcc
addons:
  apt:
    packages:
    - cmake
    - cmake-data
    - gcc-multilib
    - g++-multilib
    - libc6
    - libfltk-images1.3
    - libfltk1.3
    - libfltk1.3-dev
    - libfltk1.3-compat-headers
    - libgcc1
    - libstdc++6
    - libx11-dev
    - libxpm-dev
    - fluid
    - pkg-config
before_script:
  - mkdir build && cd build
script:
  - cmake ..
  - make -j$(nproc)
  - make DESTDIR=appdir install ; find appdir/
  - wget -c "https://github.com/probonopd/linuxdeployqt/releases/download/continuous/linuxdeployqt-continuous-x86_64.AppImage"
  - chmod a+x linuxdeployqt*.AppImage
  - unset LD_LIBRARY_PATH
  - "./linuxdeployqt*.AppImage ./appdir/usr/share/applications/jwm-settings-manager.desktop -bundle-non-qt-libs"
  - "./linuxdeployqt*.AppImage ./appdir/usr/share/applications/jwm-settings-manager.desktop -appimage"
after_success:
  - mkdir Deploy
  - find ./appdir -executable -type f -exec ldd {} \; | grep " => /usr" | cut -d " " -f 2-3 | sort | uniq
  - cp ./JWM_Settings_Manager*.AppImage Deploy/
  - curl --upload-file ./JWM_Settings_Manager*.AppImage https://transfer.sh/JWM_Settings_Manager-git.$(git rev-parse --short HEAD)-x86_64.AppImage
notifications: 
email: false
deploy:
  provider: bintray
  file: "$TRAVIS_BUILD_DIR/bintray.json"
  user: "israeldahl"
  key:
    secure: cYhN5NzegbO2UVse5ieHzCAd7sagG/LQS6cAo3YVZ51Dvd3DtOcPVyUIK7NYvFesqi48gU0wS2dRsWG5uDUsI+fDgfsOcC0bPwjWgZMmLspayrM3iNc3Are1J9O6fJrey0JxhD42PdSIGrfAcJE1dzh4Br/7xOLrhPVIKJfanUIK8opcU89T+y0DrfjAZP1brIgdKm0j7nKjT/oYzz2tUf7neJ2LBEC8UorCkMx2p5F77Hw4oHNoaiNgN4q+glx0fnAjViBnysSvpT+hqyWcIImOblUd8v1B3DOED0f2TuaQMOHQ0euSBCS70481xi2qe0U32CMO6xRpUj98CdJZrC3Z10JK441VQTqmHElw1YdOAKgwFt4zHK5DWq4Lgj1i/Uit/KeRRYB2N3F3uwPq7TftDWr0dAqWW0LLKmka1niyJ+OnAJgnbMZ4HeInDxvCvffCRAMdkmH01Y8xs4QrafQG98Jnde2RQ3KkTeKLiMhS+o8FgQmqFM2mzoV0A/53oX7O18uq/vFn+4UmY8QbfGaFHuMlmYR6B7UA8ETpga2ATHIxNAWFnOogBei3zpS5Mr1XHeUupJ4WTvfUk5CuBzIU5rjmGnvenpLHZaP+WP5eR62Fwy0xZCDxHdy03ljWaYVwMKvwwUUrmwf5i3Ks7hjsj0PRiULeXet21hTuyd4=
